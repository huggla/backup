#!/bin/sh
cd /
set -e +a +m +s +i -f
. "$(/usr/bin/dirname $0)/includeFunctions"

backupDir="$1"
readEnvironmentVars
/bin/mkdir -m 700 -p "$backupDir"
/bin/chown $VAR_LINUX_USER "$backupDir"
backupCmd="$(commandForBackupToDir "$backupDir")"
if [ -n "$backupCmd" ]
then
   set +f
   eval "$backupCmd"
   set -f
   if [ "$VAR_DELETE_DUPLICATES" == "yes" ] && [ -d "$backupDir/../latest" ]
   then
      cd "$backupDir"
      recursiveDeleteFileDuplicates
   fi
   linkDirAsLatest "$backupDir"
fi
